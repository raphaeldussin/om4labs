#!/usr/bin/env python3

import argparse
import om4labs
import sys

avail_diags = [x for x in dir(om4labs.diags) if not x.startswith("__")]


class CLI(object):
    """Top-level command line interface"""

    for diag in avail_diags:
        exec(f"from om4analysis.diags import {diag}")

    def __init__(self):
        usage = "om4plot <command> [<args>]\n\n"
        for diag in avail_diags:
            _description = eval(f"om4analysis.diags.{diag}.__description__")
            usage = usage + (f"    {diag}  {_description}\n")

        parser = argparse.ArgumentParser(
            description="Command line interface to plot standard ocean analyses",
            usage=usage,
        )
        parser.add_argument("command", help="Subcommand to run")
        args = parser.parse_args(sys.argv[1:2])
        om4analysis.diags.__dict__[diag].parse_and_run(sys.argv[2:])


if __name__ == "__main__":
    CLI()
